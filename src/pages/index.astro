---
import { getCollection } from "astro:content";
import SocialMediaIcons from "../components/SocialMediaIcons.astro";
import MatrixBackground from "../components/MatrixBackground.astro";
import ProjectItem from "../components/ProjectItem.astro";
import BaseHead from "../components/BaseHead.astro";
import { sortMDByDate } from "../utils";
import TerminalHeader from "../components/ui/TerminalHeader.astro";
import TerminalPrompt from "../components/ui/TerminalPrompt.astro";
import InfoRow from "../components/ui/InfoRow.astro";
import ExternalLink from "../components/ui/ExternalLink.astro";
import SectionHeading from "../components/ui/SectionHeading.astro";
import Divider from "../components/ui/Divider.astro";
import PostList from "../components/ui/PostList.astro";
import DesktopFolder from "../components/desktop/DesktopFolder.astro";
import DesktopWindow from "../components/desktop/DesktopWindow.astro";
import Taskbar from "../components/desktop/Taskbar.astro";
import { SITE_TITLE, SITE_DESCRIPTION } from "../config";

const MAX_POSTS = 10;
const allPosts = await getCollection("blog");
const allPostsByDate = sortMDByDate(allPosts).slice(0, MAX_POSTS);

const techStack: Record<string, string> = {
  js: "JavaScript",
  ts: "TypeScript",
  "node.js": "Node",
  astro: "This site is built on astro",
  python: "Python",
  sql: "SQL",
  "claude-code": "Best tool ever",
  "next.js": "Next.js",
  aws: "AWS",
  gcp: "GCP",
  docker: "Docker",
  tf: "Terraform",
};

const projects: Array<{
  title: string;
  description: string;
  link: string;
  icon: string;
}> = [
  {
    title: "terminus",
    description: "a minimalist astro template for developers",
    link: "https://github.com/ojoanalogo/terminus-astro-template",
    icon: "üíª",
  },
  {
    title: "Another Project",
    description: "Add your own projects here",
    icon: "üíª",
    link: "",
  },
];
---

<!doctype html>
<html
  lang="en"
  class="bg-background text-secondary selection:bg-orange-600/80 selection:text-white"
>
  <head>
    <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
    <script is:inline>
      (function () {
        const theme = localStorage.getItem("theme");
        if (
          theme === "dark" ||
          (!theme && window.matchMedia("(prefers-color-scheme: dark)").matches)
        ) {
          document.documentElement.classList.add("dark");
        }
      })();
    </script>
    <style>
      /* Desktop environment */
      body {
        margin: 0;
        overflow: hidden;
        height: 100vh;
        width: 100vw;
        position: relative;
      }

      #desktop-area {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 48px;
        overflow: hidden;
      }

      /* Scrollable on mobile */
      @media (max-width: 640px) {
        body {
          overflow: hidden;
        }
        #desktop-area {
          overflow-y: auto;
          -webkit-overflow-scrolling: touch;
        }
      }
    </style>
  </head>
  <body class="font-sans">
    <MatrixBackground
      highlightColor="rgba(222, 133, 74, 0.2)"
      boxSize={40}
      movementSpeed={0.1}
      movementDirection="up-left"
    />
    <noise></noise>

    <!-- Desktop Area -->
    <div id="desktop-area">

      <!-- ‚ïê‚ïê‚ïê Folders ‚ïê‚ïê‚ïê -->
      <DesktopFolder id="about" title="about_me" icon="üìÅ" x={40} y={30} openByDefault={true} />
      <DesktopFolder id="projects" title="projects" icon="üìÅ" x={40} y={150} />
      {allPosts.length > 0 && (
        <DesktopFolder id="blog" title="blog" icon="üìÅ" x={40} y={270} />
      )}
      <DesktopFolder id="contact" title="contact" icon="üìÅ" x={40} y={390} />
      <DesktopFolder id="skills" title="tech_stack" icon="üìÅ" x={40} y={510} />

      <!-- ‚ïê‚ïê‚ïê Windows ‚ïê‚ïê‚ïê -->

      <!-- About Me Window -->
      <DesktopWindow id="about" title="terminal - ssh guest@terminus" width="650px" height="480px" defaultOpen={true}>
        <div class="text-xs">
          <div class="flex items-center gap-2 mb-4 pb-3 border-b border-gray-300 dark:border-gray-600">
            <div class="flex gap-2" role="img" aria-label="Terminal dots">
              <div class="w-2 h-2 rounded-full bg-red-500 opacity-60"></div>
              <div class="w-2 h-2 rounded-full bg-yellow-500 opacity-60"></div>
              <div class="w-2 h-2 rounded-full bg-green-500 opacity-60"></div>
            </div>
            <span class="text-muted text-xs ml-2 hidden sm:inline">~/about_me</span>
          </div>

          <div class="space-y-4 sm:space-y-2">
            <div class="flex items-center gap-3 mb-4">
              <div class="flex flex-col gap-1">
                <h1 class="text-2xl">
                  ü™¥ hello <span class="text-primary font-medium" style="color: var(--color-primary);">visitor</span>
                </h1>
                <p class="text-muted text-xs">
                  this is terminus, an astro template
                </p>
              </div>
            </div>

            <div class="bg-gray-200/50 dark:bg-gray-500/10 rounded-lg p-3 mb-4">
              <p class="text-primary leading-relaxed" style="color: var(--color-primary);">
                you're supossed to write something interesting here, but is up to you
              </p>
            </div>

            <Divider class="mb-2" />

            <InfoRow label="location">the internet üõú</InfoRow>
            <InfoRow label="main hobby">vibecoding</InfoRow>
            <InfoRow label="current project">
              <ExternalLink href="https://google.com" label="Visit Google">
                world domination
              </ExternalLink>
            </InfoRow>
            <InfoRow label="main interests">
              science, coding, claude, startups
            </InfoRow>
            <InfoRow label="contact">
              <a
                class="text-accent hover:underline focus:outline-none"
                href="mailto:hello@youremail.com"
                aria-label="Send email to site author"
              >hello@youremail.com</a>
            </InfoRow>
            <InfoRow label="social">
              <SocialMediaIcons />
            </InfoRow>
          </div>

          <div class="mt-3 pt-2 border-t border-gray-300 dark:border-gray-700 text-muted text-xs">
            <span class="text-secondary">$</span> cat about.txt
          </div>
        </div>
      </DesktopWindow>

      <!-- Projects Window -->
      <DesktopWindow id="projects" title="~/projects" width="600px" height="400px">
        <div class="text-xs">
          <div class="flex items-center gap-2 mb-4 pb-3 border-b border-gray-300 dark:border-gray-600">
            <div class="flex gap-2">
              <div class="w-2 h-2 rounded-full bg-red-500 opacity-60"></div>
              <div class="w-2 h-2 rounded-full bg-yellow-500 opacity-60"></div>
              <div class="w-2 h-2 rounded-full bg-green-500 opacity-60"></div>
            </div>
            <span class="text-muted text-xs ml-2 hidden sm:inline">~/projects</span>
          </div>

          <SectionHeading>üíª your projects</SectionHeading>
          <div class="space-y-2" role="list">
            {projects.map((project, index) => (
              <ProjectItem
                title={project.title}
                description={project.description}
                link={project.link}
                icon={project.icon}
                index={index}
              />
            ))}
          </div>

          <div class="mt-3 pt-2 border-t border-gray-300 dark:border-gray-700 text-muted text-xs">
            <span class="text-secondary">$</span> ls -la projects/ | total {projects.length}
          </div>
        </div>
      </DesktopWindow>

      <!-- Blog Window -->
      {allPosts.length > 0 && (
        <DesktopWindow id="blog" title="~/blog" width="600px" height="420px">
          <div class="text-xs">
            <div class="flex items-center gap-2 mb-4 pb-3 border-b border-gray-300 dark:border-gray-600">
              <div class="flex gap-2">
                <div class="w-2 h-2 rounded-full bg-red-500 opacity-60"></div>
                <div class="w-2 h-2 rounded-full bg-yellow-500 opacity-60"></div>
                <div class="w-2 h-2 rounded-full bg-green-500 opacity-60"></div>
              </div>
              <span class="text-muted text-xs ml-2 hidden sm:inline">~/blog</span>
            </div>

            <SectionHeading>‚úçÔ∏è latest posts</SectionHeading>
            <PostList posts={allPostsByDate} />

            <div class="mt-3 pt-2 border-t border-gray-300 dark:border-gray-700 text-muted text-xs">
              <span class="text-secondary">$</span> tail -n {allPostsByDate.length} blog/
            </div>
          </div>
        </DesktopWindow>
      )}

      <!-- Contact Window -->
      <DesktopWindow id="contact" title="~/contact" width="500px" height="350px">
        <div class="text-xs">
          <div class="flex items-center gap-2 mb-4 pb-3 border-b border-gray-300 dark:border-gray-600">
            <div class="flex gap-2">
              <div class="w-2 h-2 rounded-full bg-red-500 opacity-60"></div>
              <div class="w-2 h-2 rounded-full bg-yellow-500 opacity-60"></div>
              <div class="w-2 h-2 rounded-full bg-green-500 opacity-60"></div>
            </div>
            <span class="text-muted text-xs ml-2 hidden sm:inline">~/contact</span>
          </div>

          <SectionHeading>üì¨ get in touch</SectionHeading>

          <div class="space-y-3">
            <InfoRow label="email">
              <a class="text-accent hover:underline" href="mailto:hello@youremail.com">hello@youremail.com</a>
            </InfoRow>
            <InfoRow label="social">
              <SocialMediaIcons />
            </InfoRow>
          </div>

          <div class="mt-6 bg-gray-200/50 dark:bg-gray-500/10 rounded-lg p-3">
            <p class="text-muted leading-relaxed">
              Feel free to reach out for collaborations, questions, or just to say hello! üëã
            </p>
          </div>

          <div class="mt-3 pt-2 border-t border-gray-300 dark:border-gray-700 text-muted text-xs">
            <span class="text-secondary">$</span> cat contact.txt
          </div>
        </div>
      </DesktopWindow>

      <!-- Tech Stack Window -->
      <DesktopWindow id="skills" title="~/tech_stack" width="550px" height="380px">
        <div class="text-xs">
          <div class="flex items-center gap-2 mb-4 pb-3 border-b border-gray-300 dark:border-gray-600">
            <div class="flex gap-2">
              <div class="w-2 h-2 rounded-full bg-red-500 opacity-60"></div>
              <div class="w-2 h-2 rounded-full bg-yellow-500 opacity-60"></div>
              <div class="w-2 h-2 rounded-full bg-green-500 opacity-60"></div>
            </div>
            <span class="text-muted text-xs ml-2 hidden sm:inline">~/tech_stack</span>
          </div>

          <SectionHeading>üõ†Ô∏è tech stack</SectionHeading>

          <div class="flex flex-wrap gap-2 mt-3" role="list" aria-label="Tech stack">
            {Object.keys(techStack).map((lang) => (
              <span
                class="px-3 py-1.5 rounded-md bg-gray-200/50 dark:bg-gray-500/10 text-secondary hover:text-accent hover:bg-gray-200/80 dark:hover:bg-gray-500/20 transition-all cursor-default border border-gray-300/50 dark:border-gray-600/30"
                title={techStack[lang]}
              >
                {lang}
              </span>
            ))}
          </div>

          <div class="mt-4 pt-2 border-t border-gray-300 dark:border-gray-700 text-muted text-xs">
            <span class="text-secondary">$</span> cat ~/.skills | sort
          </div>
        </div>
      </DesktopWindow>

    </div>

    <!-- Taskbar -->
    <Taskbar />

    <script>
      import "../scripts/desktop-manager.ts";
    </script>
  </body>
</html>
