---
import { getCollection } from "astro:content";
import SocialMediaIcons from "../components/SocialMediaIcons.astro";
import MatrixBackground from "../components/MatrixBackground.astro";
import ProjectGallery from "../components/ProjectGallery.astro";
import BaseHead from "../components/BaseHead.astro";
import { sortMDByDate } from "../utils";
import TerminalHeader from "../components/ui/TerminalHeader.astro";
import TerminalPrompt from "../components/ui/TerminalPrompt.astro";
import InfoRow from "../components/ui/InfoRow.astro";
import ExternalLink from "../components/ui/ExternalLink.astro";
import SectionHeading from "../components/ui/SectionHeading.astro";
import Divider from "../components/ui/Divider.astro";
import PostList from "../components/ui/PostList.astro";
import DesktopFolder from "../components/desktop/DesktopFolder.astro";
import DesktopWindow from "../components/desktop/DesktopWindow.astro";
import Taskbar from "../components/desktop/Taskbar.astro";
import { SITE_TITLE, SITE_DESCRIPTION } from "../config";

const MAX_POSTS = 10;
const allPosts = await getCollection("blog");
const allPostsByDate = sortMDByDate(allPosts).slice(0, MAX_POSTS);

const techStack: Record<string, string> = {
  js: "JavaScript",
  ts: "TypeScript",
  "node.js": "Node",
  astro: "This site is built on astro",
  python: "Python",
  sql: "SQL",
  "claude-code": "Best tool ever",
  "next.js": "Next.js",
  aws: "AWS",
  gcp: "GCP",
  docker: "Docker",
  tf: "Terraform",
};

const projects: Array<{
  title: string;
  description: string;
  image?: string;
  link?: string;
  engine?: string;
  language?: string;
  year?: string;
  field?: string;
  tags?: string[];
  longDescription?: string;
}> = [
  {
    title: "Hold Up",
    description: "A cozy productivity game about meeting deadlines",
    longDescription: "Hold Up is a cozy productivity game where you help characters meet their deadlines. Developed during a game jam, this project taught me a lot about rapid prototyping and working under pressure.",
    engine: "Unity",
    language: "C#", 
    year: "2023-2024",
    field: "Programming",
    tags: ["Game Jam"],
    link: "",
  },
  {
    title: "Makinado",
    description: "This very site ‚Äî built with Astro & Tailwind",
    engine: "Astro",
    language: "TypeScript",
    year: "2026",
    field: "Programming",
    tags: ["Web"],
    link: "https://github.com/sandraperezn/sandraperezn.github.io",
  },
  {
    title: "SDL Arcade Game",
    description: "Add your own project here",
    engine: "Godot",
    language: "GDScript",
    year: "2025",
    field: "Design",
    link: "",
  },
  {
    title: "Boulder Dash Remake",
    description: "Add your own project here",
    engine: "Unreal",
    language: "C++",
    year: "2025",
    field: "Art",
    link: "",
  },
  {
    title: "Shelf Control",
    description: "Add your own project here",
    engine: "Unity",
    language: "C#",
    year: "2025",
    field: "Programming",
    link: "",
  },
  {
    title: "Mechanic for Cocoon",
    description: "Add your own project here",
    engine: "Godot",
    language: "GDScript",
    year: "2024",
    field: "Art",
    link: "",
  },
  {
    title: "Card Game",
    description: "Add your own project here",
    engine: "Illustrator",
    language: "GDScript",
    year: "2024",
    field: "Art",
    link: "",
  },
  {
    title: "Card Game",
    description: "Add your own project here",
    engine: "Illustrator",
    language: "GDScript",
    year: "2024",
    field: "Art",
    link: "",
  },
  {
    title: "Card Game",
    description: "Add your own project here",
    engine: "Illustrator",
    language: "GDScript",
    year: "2024",
    field: "Art",
    link: "",
  },
  {
    title: "Card Game",
    description: "Add your own project here",
    engine: "Illustrator",
    language: "GDScript",
    year: "2024",
    field: "Art",
    link: "",
  },
];
---

<!doctype html>
<html
  lang="en"
  class="bg-background text-secondary selection:bg-orange-600/80 selection:text-white"
>
  <head>
    <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
    <script is:inline>
      (function () {
        const theme = localStorage.getItem("theme");
        if (
          theme === "dark" ||
          (!theme && window.matchMedia("(prefers-color-scheme: dark)").matches)
        ) {
          document.documentElement.classList.add("dark");
        }
      })();
    </script>
    <style>
      /* Desktop environment */
      body {
        margin: 0;
        overflow: hidden;
        height: 100vh;
        width: 100vw;
        position: relative;
      }

      #desktop-area {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 48px;
        overflow: hidden;
      }

      /* Scrollable on mobile */
      @media (max-width: 640px) {
        body {
          overflow: hidden;
        }
        #desktop-area {
          overflow-y: auto;
          -webkit-overflow-scrolling: touch;
        }
      }
    </style>
  </head>
  <body class="font-sans">
    <MatrixBackground
      highlightColor="rgba(230, 144, 214, 0.25)"
      boxSize={40}
      movementSpeed={0.1}
      movementDirection="up-left"
    />
    <noise></noise>

    <!-- Desktop Area -->
    <div id="desktop-area">

      <!-- ‚ïê‚ïê‚ïê Folders ‚ïê‚ïê‚ïê -->
      <DesktopFolder id="about" title="about_me" icon="üìÅ" x={40} y={30} openByDefault={true} />
      <DesktopFolder id="projects" title="projects" icon="üìÅ" x={40} y={130} />
      <DesktopFolder id="experience" title="experience" icon="üìÅ" x={40} y={230} />
      <DesktopFolder id="education" title="education" icon="üìÅ" x={40} y={330} />
      {allPosts.length > 0 && (
        <DesktopFolder id="blog" title="blog" icon="üìÅ" x={40} y={430} />
      )}
      <DesktopFolder id="contact" title="contact" icon="üìÅ" x={40} y={530} />
      <DesktopFolder id="skills" title="tech_stack" icon="üìÅ" x={40} y={630} />

      <!-- ‚ïê‚ïê‚ïê Windows ‚ïê‚ïê‚ïê -->

      <!-- About Me Window -->
      <DesktopWindow id="about" title="about me" width="650px" height="480px" defaultOpen={true}>
        <div class="text-xs">
          <div class="flex items-center gap-2 mb-4 pb-3 border-b border-gray-300 dark:border-gray-600">
          </div>

          <div class="space-y-4 sm:space-y-2">
            <div class="flex items-center gap-3 mb-4">
              <div class="flex flex-col gap-1">
                <h1 class="text-2xl">
                  ü™¥ hello <span class="text-primary font-medium" style="color: var(--color-primary);">visitor</span>
                </h1>
                <p class="text-muted text-xs">
                  welcome to my cv portfolio
                </p>
              </div>
            </div>

            <div class="bg-gray-200/50 dark:bg-gray-500/10 rounded-lg p-3 mb-4">
              <p class="text-primary leading-relaxed" style="color: var(--color-primary);">
                i'm sandra, a 3rd year game dev student based in barcelona who loves penguins books and videogames
              </p>
            </div>

            <Divider class="mb-2" />

            <InfoRow label="location">barcelona</InfoRow>
            <InfoRow label="main hobby">reading üìñ and gaming üéÆ </InfoRow>
            <InfoRow label="current project">
              <ExternalLink href="https://google.com" label="Visit Google">
                meet your deathline
              </ExternalLink>
            </InfoRow>
            <InfoRow label="main interests">
              creative projects, tech, videogames, journaling
            </InfoRow>
            <InfoRow label="contact">
              <a
                class="text-accent hover:underline focus:outline-none"
                href="mailto:sandrapereznvs@gmail.com"
                aria-label="Send email to site author"
              >sandrapereznvs@gmail.com</a>
            </InfoRow>
            <InfoRow label="social">
              <SocialMediaIcons />
            </InfoRow>
          </div>

          <div class="mt-3 pt-2 border-t border-gray-300 dark:border-gray-700 text-muted text-xs">
            <span class="text-secondary">$</span> cat about.txt
          </div>
        </div>
      </DesktopWindow>

      <!-- Projects Window -->
      <DesktopWindow id="projects" title="~/projects" width="800px" height="600px">
        <ProjectGallery projects={projects} />
      </DesktopWindow>

      <!-- Experience Window -->
      <DesktopWindow id="experience" title="~/experience" width="600px" height="450px">
        <div class="text-xs">
          <SectionHeading>üíº work experience</SectionHeading>
          
          <div class="space-y-4 mt-4">
            <div class="experience-item p-3 bg-gray-200/50 dark:bg-gray-500/10 rounded-lg">
              <div class="flex justify-between items-start mb-2">
                <h3 class="font-semibold text-primary" style="color: var(--color-primary);">Job Title</h3>
                <span class="text-muted text-xs">2024 - Present</span>
              </div>
              <p class="text-accent font-medium text-sm mb-2">Company Name</p>
              <p class="text-muted text-xs leading-relaxed">
                Description of your role and responsibilities. What did you achieve? What technologies did you use?
              </p>
            </div>

            <div class="experience-item p-3 bg-gray-200/50 dark:bg-gray-500/10 rounded-lg">
              <div class="flex justify-between items-start mb-2">
                <h3 class="font-semibold text-primary" style="color: var(--color-primary);">Previous Job</h3>
                <span class="text-muted text-xs">2022 - 2024</span>
              </div>
              <p class="text-accent font-medium text-sm mb-2">Previous Company</p>
              <p class="text-muted text-xs leading-relaxed">
                Description of your previous role. Highlight key achievements and skills developed.
              </p>
            </div>
          </div>

          <div class="mt-4 pt-2 border-t border-gray-300 dark:border-gray-700 text-muted text-xs">
            <span class="text-secondary">$</span> cat experience.txt
          </div>
        </div>
      </DesktopWindow>

      <!-- Education Window -->
      <DesktopWindow id="education" title="~/education" width="600px" height="450px">
        <div class="text-xs">
          <SectionHeading>üéì education</SectionHeading>
          
          <div class="space-y-4 mt-4">
            <div class="education-item p-3 bg-gray-200/50 dark:bg-gray-500/10 rounded-lg">
              <div class="flex justify-between items-start mb-2">
                <h3 class="font-semibold text-primary" style="color: var(--color-primary);">Game Development Degree</h3>
                <span class="text-muted text-xs">2023 - Present</span>
              </div>
              <p class="text-accent font-medium text-sm mb-2">University Name, Barcelona</p>
              <p class="text-muted text-xs leading-relaxed">
                3rd year student. Focusing on game programming, design, and development. 
                Learning Unity, Unreal Engine, and various programming languages.
              </p>
            </div>

            <div class="education-item p-3 bg-gray-200/50 dark:bg-gray-500/10 rounded-lg">
              <div class="flex justify-between items-start mb-2">
                <h3 class="font-semibold text-primary" style="color: var(--color-primary);">High School Diploma</h3>
                <span class="text-muted text-xs">2019 - 2023</span>
              </div>
              <p class="text-accent font-medium text-sm mb-2">High School Name</p>
              <p class="text-muted text-xs leading-relaxed">
                Relevant coursework or achievements during high school.
              </p>
            </div>
          </div>

          <div class="mt-4 pt-2 border-t border-gray-300 dark:border-gray-700 text-muted text-xs">
            <span class="text-secondary">$</span> cat education.txt
          </div>
        </div>
      </DesktopWindow>

      <!-- Blog Window -->
      {allPosts.length > 0 && (
        <DesktopWindow id="blog" title="~/blog" width="600px" height="420px">
          <div class="text-xs">
            <div class="flex items-center gap-2 mb-4 pb-3 border-b border-gray-300 dark:border-gray-600">
              <span class="text-muted text-xs ml-2 hidden sm:inline">~/blog</span>
            </div>

            <SectionHeading>‚úçÔ∏è latest posts</SectionHeading>
            <PostList posts={allPostsByDate} />

            <div class="mt-3 pt-2 border-t border-gray-300 dark:border-gray-700 text-muted text-xs">
              <span class="text-secondary">$</span> tail -n {allPostsByDate.length} blog/
            </div>
          </div>
        </DesktopWindow>
      )}

      <!-- Contact Window -->
      <DesktopWindow id="contact" title="~/contact" width="500px" height="350px">


          <SectionHeading>üì¨ get in touch</SectionHeading>

          <div class="space-y-3">
            <InfoRow label="email">
              <a class="text-accent hover:underline" href="mailto:hello@youremail.com">hello@youremail.com</a>
            </InfoRow>
            <InfoRow label="social">
              <SocialMediaIcons />
            </InfoRow>
          </div>

          <div class="mt-6 bg-gray-200/50 dark:bg-gray-500/10 rounded-lg p-3">
            <p class="text-muted leading-relaxed">
              Feel free to reach out for collaborations, questions, or just to say hello! üëã
            </p>
          </div>

          <div class="mt-3 pt-2 border-t border-gray-300 dark:border-gray-700 text-muted text-xs">
            <span class="text-secondary">$</span> cat contact.txt
          </div>
        </div>
      </DesktopWindow>

      <!-- Tech Stack Window -->
      <DesktopWindow id="skills" title="~/tech_stack" width="550px" height="380px">
        <div class="text-xs">
          <div class="flex items-center gap-2 mb-4 pb-3 border-b border-gray-300 dark:border-gray-600">
            <span class="text-muted text-xs ml-2 hidden sm:inline">~/tech_stack</span>
          </div>

          <SectionHeading>üõ†Ô∏è tech stack</SectionHeading>

          <div class="flex flex-wrap gap-2 mt-3" role="list" aria-label="Tech stack">
            {Object.keys(techStack).map((lang) => (
              <span
                class="px-3 py-1.5 rounded-md bg-gray-200/50 dark:bg-gray-500/10 text-secondary hover:text-accent hover:bg-gray-200/80 dark:hover:bg-gray-500/20 transition-all cursor-default border border-gray-300/50 dark:border-gray-600/30"
                title={techStack[lang]}
              >
                {lang}
              </span>
            ))}
          </div>

          <div class="mt-4 pt-2 border-t border-gray-300 dark:border-gray-700 text-muted text-xs">
            <span class="text-secondary">$</span> cat ~/.skills | sort
          </div>
        </div>
      </DesktopWindow>

    </div>

    <!-- Taskbar -->
    <Taskbar />

    <script>
      import "../scripts/desktop-manager.ts";
    </script>
  </body>
</html>
